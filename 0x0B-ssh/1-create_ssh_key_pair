#!/usr/bin/env bash
# Define the file path where the RSA private key will be saved
KEY_PATH="$HOME/.ssh/school"

# Define the passphrase for the RSA key
PASSPHRASE="betty"

# Check if the key file already exists
if [ -f "$KEY_PATH" ]; then
    echo "Error: Key file $KEY_PATH already exists."
    echo "Please remove or rename the existing file before running this script."
    exit 1
fi

# Generate an RSA key pair with ssh-keygen, including the passphrase and key length of 4096 bits
ssh-keygen -t rsa -b 4096 -f $KEY_PATH -N "$PASSPHRASE" -C "Generated by script"

# Verify if the key file has been created and is an RSA private key
if [ -f "$KEY_PATH" ]; then
    echo "RSA key pair successfully generated:"
    echo "Private Key: $KEY_PATH"
    echo "Public Key: $KEY_PATH.pub"

    # Verify that the private key file is indeed an RSA private key
    if grep -q "BEGIN OPENSSH PRIVATE KEY" "$KEY_PATH"; then
        echo "The file $KEY_PATH is a valid RSA private key."
    else
        echo "The file $KEY_PATH does not appear to be a valid RSA private key."
        exit 1
    fi
else
    echo "Failed to generate the RSA key pair."
    exit 1
fi

